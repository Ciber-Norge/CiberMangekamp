!!!
%haml
  %head
    %title Ciber Mangekamp

  %body
    %h1
      = @season.title

    %p
      = link_to 'Tilbake', root_path
      |
      = link_to 'Edit season', edit_season_path(@season.id)
      |
      = link_to 'Delete season', { action: :destroy, id: @season }, method: :delete, data: { confirm: 'Are you sure?' }
      |
      = link_to 'Add event', new_season_event_path(@season.id)

    %ul
      - @season.events.each do | event |
        %li
          = link_to event.title, event

    %h1 Leaderboard

    %table{:border => 1}
      %thead
        %tr
          %td Rank
          %td Name
          -# @season.events.each do | event |
            #%td
              =# link_to event.title, event
          %td Total Points
      %tbody
        - events = @season.events
        - leaderboard = {}
        - events.each do |event|
          - event.participants.each do | participant |
            - unless leaderboard[participant.user.name] then leaderboard[participant.user.name] = {} end
            - leaderboard[participant.user.name][event.title] = participant.result.rank
        %br
        - leaderboard.each do | key, value|
          - value[:score] = value.map { |h| h[1] }.sum

        - leaderboard.sort_by {|key, value| value[:score]}.each_with_index do | value, index |
          %tr
            %td
              = index + 1
            %td
              = value[0]
            %td
              = value[1].map { |h| h[1] }.sum
